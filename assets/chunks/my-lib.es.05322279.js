import{d as U,a2 as tt,Y as _,x as K,h as y,o as v,c as p,F as et,D as nt,N as rt,M as E,j as ot,z as it,k as I,g as A,r as st,l as z,aj as at,ak as ut}from"./framework.12b7deed.js";function lt(t){return at()?(ut(t),!0):!1}const Y=typeof window<"u";function ct(t,e){function n(...r){t(()=>e.apply(this,r),{fn:e,thisArg:this,args:r})}return n}function ft(t,e={}){let n,r;return s=>{const i=z(t),a=z(e.maxWait);if(n&&clearTimeout(n),i<=0||a!==void 0&&a<=0)return r&&(clearTimeout(r),r=null),s();a&&!r&&(r=setTimeout(()=>{n&&clearTimeout(n),r=null,s()},a)),n=setTimeout(()=>{r&&clearTimeout(r),r=null,s()},i)}}function dt(t,e=200,n={}){return ct(ft(e,n),t)}function mt(t){var e;const n=z(t);return(e=n==null?void 0:n.$el)!=null?e:n}const yt=Y?window:void 0,R=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},j="__vueuse_ssr_handlers__";R[j]=R[j]||{};var L=Object.getOwnPropertySymbols,gt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable,wt=(t,e)=>{var n={};for(var r in t)gt.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&L)for(var r of L(t))e.indexOf(r)<0&&ht.call(t,r)&&(n[r]=t[r]);return n};function vt(t,e,n={}){const r=n,{window:o=yt}=r,s=wt(r,["window"]);let i;const a=o&&"ResizeObserver"in o,u=()=>{i&&(i.disconnect(),i=void 0)},l=K(()=>mt(t),c=>{u(),a&&o&&c&&(i=new ResizeObserver(e),i.observe(c,s))},{immediate:!0,flush:"post"}),f=()=>{u(),l()};return lt(f),{isSupported:a,stop:f}}var T,P;Y&&(window!=null&&window.navigator)&&((T=window==null?void 0:window.navigator)!=null&&T.platform)&&/iP(ad|hone|od)/.test((P=window==null?void 0:window.navigator)==null?void 0:P.platform);const pt=({breakpoints:t,wrapperWidth:e,gutter:n,hasAroundGutter:r,initWidth:o})=>{const s=Object.keys(t).map(l=>Number(l)).sort((l,f)=>l-f);let i=e,a=!1;for(const l of s)if(e<=l){i=l,a=!0;break}if(!a)return o;const u=t[i].rowPerView;return r?(e-n)/u-n:(e-(u-1)*n)/u};function bt(t){const e=y(0),n=y(null);vt(n,i=>{const a=i[0],{width:u}=a.contentRect;e.value=u});const r=A(()=>pt({wrapperWidth:e.value,breakpoints:t.breakpoints,gutter:t.gutter,hasAroundGutter:t.hasAroundGutter,initWidth:t.width})),o=A(()=>{const i=t.hasAroundGutter?-t.gutter:t.gutter;return Math.floor((e.value+i)/(r.value+t.gutter))}),s=A(()=>{const i=t.hasAroundGutter?t.gutter:-t.gutter,a=o.value*(r.value+t.gutter)+i;return(e.value-a)/2});return{waterfallWrapper:n,wrapperWidth:e,colWidth:r,cols:o,offsetX:s}}function X(t,e){return new RegExp(`(^|\\s)${e}(\\s|$)`).test(t.className)}function N(t,e){if(X(t,e))return;const n=t.className.split(/\s+/);n.push(e),t.className=n.join(" ")}const _t=document.createElement("div").style,O=(()=>{const t={webkit:"webkitTransform",Moz:"MozTransform",O:"OTransform",ms:"msTransform",standard:"transform"};for(const e in t){const n=t[e];if(_t[n]!==void 0)return e}return!1})();function h(t){return O===!1?!1:O==="standard"?t:O+t.charAt(0).toUpperCase()+t.substr(1)}const C=h("transform"),D=h("animation-duration"),x=h("animation-delay"),B=h("transition"),k=h("animation-fill-mode");function At(t,e,n,r,o){const s=y([]),i=y(0),a=c=>{const d=t.hasAroundGutter?c+1:c;return t.gutter*d+e.value*c+r.value},u=()=>{s.value=new Array(n.value).fill(t.hasAroundGutter?t.gutter:0)},l=Ot(t);return{wrapperHeight:i,layoutHandle:async()=>{u();const c=[];if(o&&o.value&&o.value.childNodes.forEach(d=>{d.className==="waterfall-item"&&c.push(d)}),c.length===0)return!1;for(let d=0;d<c.length;d++){const m=c[d],w=Math.min.apply(null,s.value),$=s.value.indexOf(w),J=a($),b=m.style;C&&(b[C]=`translate3d(${J}px,${w}px, 0)`),b.width=`${e.value}px`;const{height:Z}=m.getBoundingClientRect();s.value[$]+=Z+t.gutter,l(m,()=>{B&&(b[B]="transform .3s")})}i.value=Math.max.apply(null,s.value)}}}function Ot(t){return(e,n)=>{const r=e.firstChild;if(r&&!X(r,t.animationPrefix)){const o=`${t.animationDuration/1e3}s`,s=`${t.animationDelay/1e3}s`,i=r.style;i.visibility="visible",D&&(i[D]=o),x&&(i[x]=s),k&&(i[k]="both"),N(r,t.animationPrefix),N(r,t.animationEffect),n&&setTimeout(()=>{n()},t.animationDuration+t.animationDelay)}}}const It=typeof window<"u"&&window!==null,W=$t(),zt=Object.prototype.propertyIsEnumerable,F=Object.getOwnPropertySymbols;function St(t,...e){return e.map(r=>r.replace(/\[(\w+)\]/g,".$1").split(".").reduce((o,s)=>o&&o[s],t))}function $t(){return It&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype?("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get(){return this.intersectionRatio>0}}),!0):!1}function g(t){return typeof t=="function"||toString.call(t)==="[object Object]"}function Et(t){return typeof t=="object"?t===null:typeof t!="function"}function Rt(t){return t!=="__proto__"&&t!=="constructor"&&t!=="prototype"}function jt(t,...e){if(!g(t))throw new TypeError("expected the first argument to be an object");if(e.length===0||typeof Symbol!="function"||typeof F!="function")return t;for(const n of e){const r=F(n);for(const o of r)zt.call(n,o)&&(t[o]=n[o])}return t}function Q(t,...e){let n=0;for(Et(t)&&(t=e[n++]),t||(t={});n<e.length;n++)if(g(e[n])){for(const r of Object.keys(e[n]))Rt(r)&&(g(t[r])&&g(e[n][r])?Q(t[r],e[n][r]):t[r]=e[n][r]);jt(t,e[n])}return t}function M(t,e){return new Promise((n,r)=>{const o=new Image;o.onload=()=>{n(o)},o.onerror=()=>{r(new Error("Image load error"))},e&&(o.crossOrigin="Anonymous"),o.src=t})}const Lt={rootMargin:"0px",threshold:0},V="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Tt="";class Pt{constructor(e=!0,n,r=!0){this.lazyActive=!0,this.crossOrigin=!0,this.options={loading:V,error:Tt,observerOptions:Lt,log:!0},this._images=new WeakMap,this.lazyActive=e,this.crossOrigin=r,this.config(n)}config(e={}){Q(this.options,e)}mount(e,n,r){const{src:o,loading:s,error:i}=this._valueFormatter(n);e.setAttribute("lazy","loading"),e.setAttribute("src",s||V),this.lazyActive?(W||(this._setImageSrc(e,o,r,i),this._log(()=>{throw new Error("Not support IntersectionObserver!")})),this._initIntersectionObserver(e,o,r,i)):this._setImageSrc(e,o,r,i)}resize(e,n){const r=e.getAttribute("lazy"),o=e.getAttribute("src");r&&r==="loaded"&&o&&M(o,this.crossOrigin).then(s=>{const{width:i,height:a}=s,u=e.width/i*a;e.height=u;const l=e.style;l.height=`${u}px`,n()})}unmount(e){const n=this._realObserver(e);n&&n.unobserve(e),this._images.delete(e)}_setImageSrc(e,n,r,o){!n||e.getAttribute("src")===n||M(n,this.crossOrigin).then(i=>{const{width:a,height:u}=i,l=u/a,f=e.parentNode.parentNode;f.style.paddingBottom=`${l*100}%`,e.setAttribute("lazy","loaded"),e.removeAttribute("src"),e.setAttribute("src",n),r(!0)}).catch(()=>{const i=this._realObserver(e);i&&i.disconnect(),o&&(e.setAttribute("lazy","error"),e.setAttribute("src",o),r(!1)),this._log(()=>{throw new Error(`Image failed to load!And failed src was: ${n} `)})})}_isOpenLazy(){return W&&this.lazyActive}_initIntersectionObserver(e,n,r,o){const s=this.options.observerOptions;this._images.set(e,new IntersectionObserver(a=>{Array.prototype.forEach.call(a,u=>{if(u.isIntersecting){const l=this._realObserver(e);l&&l.unobserve(u.target),this._setImageSrc(e,n,r,o)}})},s));const i=this._realObserver(e);i&&i.observe(e)}_valueFormatter(e){let n=e,r=this.options.loading,o=this.options.error;return g(e)&&(n=e.src,r=e.loading||this.options.loading,o=e.error||this.options.error),{src:n,loading:r,error:o}}_log(e){this.options.log&&e()}_realObserver(e){return this._images.get(e)}}var q=(t,e)=>{const n=t.__vccOpts||t;for(const[r,o]of e)n[r]=o;return n};const S=U({props:{list:{type:Array,default:()=>[]},rowKey:{type:String,default:"id"},imgSelector:{type:String,default:"src"},width:{type:Number,default:200},breakpoints:{type:Object,default:()=>({1200:{rowPerView:3},800:{rowPerView:2},500:{rowPerView:1}})},gutter:{type:Number,default:10},hasAroundGutter:{type:Boolean,default:!0},animationPrefix:{type:String,default:"animate__animated"},animationEffect:{type:String,default:"fadeIn"},animationDuration:{type:Number,default:1e3},animationDelay:{type:Number,default:300},backgroundColor:{type:String,default:"#fff"},lazyload:{type:Boolean,default:!0},loadProps:{type:Object,default:()=>{}},crossOrigin:{type:Boolean,default:!0},delay:{type:Number,default:300}},setup(t){const e=new Pt(t.lazyload,t.loadProps,t.crossOrigin);_("lazy",e);const{waterfallWrapper:n,wrapperWidth:r,colWidth:o,cols:s,offsetX:i}=bt(t),{wrapperHeight:a,layoutHandle:u}=At(t,o,s,i,n),l=dt(()=>{u()},t.delay);K(()=>[r,o,t.list],()=>{r.value>0&&l()},{deep:!0});const f=y(0);return _("sizeChangeTime",f),_("imgLoaded",l),{waterfallWrapper:n,wrapperHeight:a,getRenderURL:m=>St(m,t.imgSelector)[0],getKey:(m,w)=>m[t.rowKey]||w,renderer:l}}}),G=()=>{tt(t=>({"1d5a2b91":t.backgroundColor}))},H=S.setup;S.setup=H?(t,e)=>(G(),H(t,e)):G;const Nt=S,Ct={class:"waterfall-card"};function Dt(t,e,n,r,o,s){return v(),p("div",{ref:"waterfallWrapper",class:"waterfall-list",style:rt({height:`${t.wrapperHeight}px`})},[(v(!0),p(et,null,nt(t.list,(i,a)=>(v(),p("div",{key:t.getKey(i,a),class:"waterfall-item"},[I("div",Ct,[st(t.$slots,"item",{item:i,index:a,url:t.getRenderURL(i)},void 0,!0)])]))),128))],4)}var Mt=q(Nt,[["render",Dt],["__scopeId","data-v-2465a0ec"]]);const xt=U({props:{url:{type:String,default:""}},setup(t,e){const n=E("imgLoaded"),r=E("lazy"),o=y(null);ot(()=>{s()}),it(()=>{i()});function s(){o.value&&r.mount(o.value,t.url,u=>{n(),u?e.emit("success",t.url):e.emit("error",t.url)})}function i(){o.value&&r.unmount(o.value)}function a(){e.emit("load",t.url)}return{lazyRef:o,imageLoad:a}}}),Bt={class:"lazy__box"},kt={class:"lazy__resource"};function Wt(t,e,n,r,o,s){return v(),p("div",Bt,[I("div",kt,[I("img",{ref:"lazyRef",class:"lazy__img",onLoad:e[0]||(e[0]=(...i)=>t.imageLoad&&t.imageLoad(...i))},null,544)])])}var Vt=q(xt,[["render",Wt],["__scopeId","data-v-019f8998"]]);export{Vt as LazyImg,Mt as Waterfall};
